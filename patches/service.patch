--- pkg/mod/github.com/fatedier/frp@v0.40.0/client/service.go	2022-03-23 17:35:01.000000000 +0800
+++ patches/service.go	2022-03-23 17:52:35.000000000 +0800
@@ -36,12 +36,13 @@
 	"github.com/fatedier/frp/pkg/util/util"
 	"github.com/fatedier/frp/pkg/util/version"
 	"github.com/fatedier/frp/pkg/util/xlog"
 	libdial "github.com/fatedier/golib/net/dial"

 	fmux "github.com/hashicorp/yamux"
+	frpmgr "github.com/koho/frpmgr/pkg/util"
 )

 // Service is a client service.
 type Service struct {
 	// uniq id got from frps, attach it in loginMsg
 	runID string
@@ -247,14 +248,20 @@
 		libdial.WithProxyAuth(auth),
 		libdial.WithTLSConfig(tlsConfig),
 		libdial.WithAfterHook(libdial.AfterHook{
 			Hook: frpNet.DialHookCustomTLSHeadByte(tlsConfig != nil, svr.cfg.DisableCustomTLSFirstByte),
 		}),
 	)
+	var serverAddr = svr.cfg.ServerAddr
+	if svr.cfg.DNSServer != "" && runtime.GOOS == "windows" {
+		if serverAddr, err = frpmgr.LookupIP(svr.cfg.ServerAddr, svr.cfg.DNSServer); err != nil {
+			return nil, nil, err
+		}
+	}
 	conn, err = libdial.Dial(
-		net.JoinHostPort(svr.cfg.ServerAddr, strconv.Itoa(svr.cfg.ServerPort)),
+		net.JoinHostPort(serverAddr, strconv.Itoa(svr.cfg.ServerPort)),
 		dialOptions...,
 	)
 	if err != nil {
 		return
 	}
